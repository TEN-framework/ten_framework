#
# Copyright Â© 2024 Agora
# This file is part of TEN Framework, an open source project.
# Licensed under the Apache License, Version 2.0, with certain conditions.
# Refer to the "LICENSE" file in the root directory for more information.
#
import("//build/feature/ten_package.gni")

config("gtest_libs") {
  if (is_win) {
    libs = [ "gtest.dll.lib" ]
  } else {
    libs = [ "gtest" ]
  }
}

config("gtest_common_config") {
  configs = [ ":gtest_libs" ]

  include_dirs = [ "//ten_packages/system/googletest/include" ]
  lib_dirs = [ "//ten_packages/system/googletest/lib" ]
}

config("config_for_app") {
  configs = [ ":gtest_common_config" ]

  if (is_linux) {
    ldflags = [ "-Wl,-rpath=\$ORIGIN/../ten_packages/system/googletest/lib" ]
  } else if (is_mac) {
    ldflags =
        [ "-Wl,-rpath,@loader_path/../ten_packages/system/googletest/lib" ]
  }
}

config("config_for_ten_packages") {
  configs = [ ":gtest_common_config" ]

  if (is_linux) {
    ldflags = [ "-Wl,-rpath=\$ORIGIN/../../../system/googletest/lib" ]
  } else if (is_mac) {
    ldflags = [ "-Wl,-rpath,@loader_path/../../../system/googletest/lib" ]
  }
}

config("config_for_standalone_ten_packages") {
  configs = [ ":gtest_libs" ]

  include_dirs = [ "//.ten/app/ten_packages/system/googletest/include" ]
  lib_dirs = [ "//.ten/app/ten_packages/system/googletest/lib" ]

  if (is_linux) {
    ldflags = [ "-Wl,-rpath=\$ORIGIN/../ten_packages/system/googletest/lib" ]
  } else if (is_mac) {
    ldflags =
        [ "-Wl,-rpath,@loader_path/../ten_packages/system/googletest/lib" ]
  }
}

ten_package("googletest") {
  package_kind = "system"

  resources = [
    "include",
    "lib",
    "manifest.json",

    # This file is merely provided for the convenience of development. C++
    # extensions are not required to use this file provided by the gtest system
    # package. Extensions can define their own `main` function within their test
    # cases. However, the gtest system package offers this file as a convenience
    # for C++ extensions that do not have customized testing requirements.
    "src/gtest_main.cc",
  ]
}
