#
# Copyright Â© 2024 Agora
# This file is part of TEN Framework, an open source project.
# Licensed under the Apache License, Version 2.0, with certain conditions.
# Refer to the "LICENSE" file in the root directory for more information.
#
config("gtest_header") {
  include_dirs = [
    ".",
    "include",
    "../googlemock",
    "../googlemock/include",
  ]
}

source_set("googletest") {
  public_configs = [ ":gtest_header" ]

  sources = [ "src/gtest-all.cc" ]
}

source_set("gtest_main") {
  public_configs = [ ":gtest_header" ]

  sources = [ "src/gtest_main.cc" ]
}

ten_package("googletest") {
  package_kind = "custom"
  package_output_root_dir_name = "ten_manager"

  tman_output = get_target_outputs(":tman")

  if (is_win) {
    use_shared_lib = true
  }

  resources = []
  if (is_win) {
    resources += [ "${tman_output[0]}=>bin/tman.exe" ]
  } else {
    resources += [ "${tman_output[0]}=>bin/tman" ]
  }

  if (use_shared_lib) {
    lib_dest_folder = "lib"
    if (is_win) {
      # In Windows, all .dll used by the executable must be in the same folder.
      lib_dest_folder = "bin"
    }

    foreach(lib, clingo_output_libs) {
      libname = get_path_info(rebase_path(lib), "file")
      resources += [ "${lib}=>${lib_dest_folder}/${libname}" ]
    }
  }

  deps = [
    ":tman",
    "//third_party/clingo",
  ]

  if (use_shared_lib) {
    # Copy relevant resources files.
    deps += [ ":copy_clingo_config_files" ]
  }
}
